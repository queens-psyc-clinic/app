name: Backend Tests
run-name: ${{ github.actor }} is testing out the API ğŸš€
on: [pull_request]

jobs:
  test-api:
    runs-on: ubuntu-latest
    steps:

      - name: ğŸ” Check out repository code
        uses: actions/checkout@v4

      - name: ğŸ’¸ setup docker
        uses: docker/setup-buildx-action@v3

      - name: ğŸ‘· build containers
        uses: docker/bake-action@v3
        with: 
          load: true

      - name: ğŸ³ start backend
        run: docker-compose up -d

      - name: ğŸ§ª test api
        uses: schemathesis/action@v1
        with:
          schema: 'http://localhost:5050/apispec_1.json'
          checks: 'all'

      - name: ğŸ§¼ clean up
        if: always()
        run: docker-compose down
